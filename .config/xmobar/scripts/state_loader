#!/usr/bin/env bash

STATE_FILE="${HOME}/.config/xmobar/scripts/state"

state_init() {
  local key="$1"
  local default="$2"

  if ! grep -q "^${key}=" "$STATE_FILE" 2>/dev/null; then
    echo "${key}=${default}" >> "$STATE_FILE"
    eval "${key}=\"${default}\""
  else
    # Load existing value from state file
    local value=$(grep "^${key}=" "$STATE_FILE" | cut -d= -f2-)
    # Properly escape the value for eval
    eval "${key}=${value}"
  fi
}

state_update() {
  local key="$1"
  local value="$2"

  sed -i "s|^${key}=.*|${key}=${value}|" "$STATE_FILE"
}
