#!/usr/bin/env bash

# Centralized loading - export all vars/state to child processes
set -a  # Auto-export all variables
source "${HOME}/.config/xmobar/scripts/vars"
source "${HOME}/.config/xmobar/scripts/state"
set +a

COM="${HOME}/.config/xmobar/com"

components=(
  "capslock"
  "updates"
  "volume:<fc="$COLOR_MUTE">ó°œ¥</fc>"
  "volume_output"
  "brightness"
  "bluetooth"
  "battery"
  "space"
  "vpn"
  "network"
  "cpu_temp"
  "sys_usage"
  "weather"
  "speedtest"
  "rofi_theme"
  "yt_dl"
  "wallpaper"
  "screenshot"
  "automount"
  "page"
  "calendar"
  "power"
)

bar=""
for c in "${components[@]}"; do
  IFS=':' read -r component sep <<< "$c"
  bar+="$("$COM/$component/render" "--sep=$sep")"
done

printf '%s\n' "$bar"
