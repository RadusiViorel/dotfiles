#!/usr/bin/env bash

source "${HOME}/.config/xmobar/scripts/terminal_launcher"

LOG_DIR="${HOME}/.config/xmobar/com/updates/logs"
MASTER_LOG="${LOG_DIR}/updates.log"

# Ensure log exists
if [[ ! -f "$MASTER_LOG" ]]; then
  mkdir -p "$LOG_DIR"
  echo "No update history yet." > "$MASTER_LOG"
fi

# Open the log in a terminal with less
terminal_launch \
  --title "Update History" \
  --class "float-large" \
  --command "
    echo '=== Package Update History ==='
    echo
    if [[ -f '$MASTER_LOG' ]]; then
      cat '$MASTER_LOG'
    else
      echo 'No updates logged yet.'
    fi
    echo
    echo '=== Session Logs ==='
    echo 'Individual session logs available in: $LOG_DIR'
    ls -1t '$LOG_DIR'/session_*.log 2>/dev/null | head -10 | while read file; do
      echo \"  - \$(basename \"\$file\")\"
    done
    echo
    read -p 'Press enter to exit...'
  "
