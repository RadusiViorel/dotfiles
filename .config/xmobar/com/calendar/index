#!/usr/bin/env bash

source "${HOME}/.config/xmobar/scripts/check_dependency"
check_dependency "yad" --no-exit

COM="${HOME}/.config/xmobar/com/calendar"
[[ -n "$1" ]] && STATE_FILE="${HOME}/.config/xmobar/scripts/state" && source "${STATE_FILE}"

source "${HOME}/.config/xmobar/scripts/vars"

STATE_FILE_LOADER="${HOME}/.config/xmobar/scripts/state_loader"
source $STATE_FILE_LOADER
state_init "calendar_toggle" 0

case "$1" in
  toggle) ${COM}/actions/toggle               \
    --value=${calendar_toggle}                \
    --STATE_FILE=${STATE_FILE}                \
    --STATE_FILE_LOADER=${STATE_FILE_LOADER}  \
    --KEY=calendar_toggle ;;
  show_calendar) ${COM}/actions/show_calendar;;
  *) ;;
esac

declare -A ICONS=(
  [00]=""
  [01]=""
  [02]=""
  [03]=""
  [04]=""
  [05]=""
  [06]=""
  [07]=""
  [08]=""
  [09]=""
  [10]=""
  [11]=""
  [12]="󱑊"
  [13]="󱐿"
  [14]="󱑀"
  [15]="󱑁"
  [16]="󱑂"
  [17]="󱑃"
  [18]="󱑄"
  [19]="󱑅"
  [20]="󱑆"
  [21]="󱑇"
  [22]="󱑈"
  [23]="󱑉"
)

format=$([[ calendar_toggle -eq 1 ]] && echo "%d-%m-%Y" || echo "%H:%M:%S" )
icon=$([[   calendar_toggle -eq 1 ]] && echo " "                || echo "<fn=1>${ICONS[$(date +%H)]}</fn>" )
color=$([[  calendar_toggle -eq 1 ]] && echo ${COLOR_WARNING} || echo ${COLOR_OK} )

echo "<fc=${color}>${icon} $(date +"$format")</fc>"
