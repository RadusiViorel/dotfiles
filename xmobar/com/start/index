#!/usr/bin/env bash

source "${HOME}/.config/xmobar/scripts/vars"

# Emits a bright HEX color that changes slowly over the day
# Designed for dark backgrounds (no dark tones)

# seconds since midnight
now=$(date +%s)
midnight=$(date -d "$(date +%F) 00:00:00" +%s)
t=$((now - midnight))

# normalize to 0..2π over 24h
pi=3.141592653589793
phase=$(awk -v t="$t" -v pi="$pi" 'BEGIN { print (t / 86400) * 2 * pi }')

# sine-based RGB, phase-shifted
r=$(awk -v p="$phase" 'BEGIN { printf "%d", 180 + 60 * sin(p) }')
g=$(awk -v p="$phase" 'BEGIN { printf "%d", 180 + 60 * sin(p + 2.094) }')
b=$(awk -v p="$phase" 'BEGIN { printf "%d", 180 + 60 * sin(p + 4.188) }')

# clamp (safety, keeps it bright)
clamp() {
  (( $1 < 150 )) && echo 150 && return
  (( $1 > 255 )) && echo 255 && return
  echo "$1"
}

r=$(clamp "$r")
g=$(clamp "$g")
b=$(clamp "$b")

color=$(printf "#%02x%02x%02x\n" "$r" "$g" "$b")

echo "<fc=${color}></fc> ${SEP}"
