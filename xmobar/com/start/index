#!/usr/bin/env bash

# seconds since midnight
now=$(date +%s)
midnight=$(date -d "$(date +%F) 00:00:00" +%s)
t=$((now - midnight))

# Consolidate all awk calls into single invocation for better performance
read r g b < <(awk -v t="$t" 'BEGIN {
  pi = 3.141592653589793
  phase = (t / 86400) * 2 * pi
  printf "%d %d %d", 180 + 60 * sin(phase), 180 + 60 * sin(phase + 2.094), 180 + 60 * sin(phase + 4.188)
}')

# clamp (safety, keeps it bright)
clamp() {
  (( $1 < 150 )) && echo 150 && return
  (( $1 > 255 )) && echo 255 && return
  echo "$1"
}

r=$(clamp "$r")
g=$(clamp "$g")
b=$(clamp "$b")

color=$(printf "#%02x%02x%02x\n" "$r" "$g" "$b")

echo "<fc=${color}>ïŒ®</fc> ${SEP}"
