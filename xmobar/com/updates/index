#!/usr/bin/env bash

source "${HOME}/.config/xmobar/scripts/vars"

WARNING_COLOR="#f58989"
WARNING_COUNT=15

packageList=$(xbps-install -nuM)
count=$(printf "%s\n" "$packageList" | grep -cve '^\s*$')

show() {
    # Open a terminal and run the commands
    $TERM -e bash -c "echo -e '$packageList \n Updated $count packages:\n'; sudo xbps-install -Su; echo; read -p 'Press enter to exit...'"
}

case "$1" in
    show) show ;;
    *) ;;
esac

# No updates → show nothing
(( count == 0 )) && exit 0

output="  $count"

# Warning color for >=15 updates
if (( count >= WARNING_COUNT )); then
    echo "<fc=${WARNING_COLOR}>${output}</fc> |"
else
    echo "$output ${SEP}"
fi
