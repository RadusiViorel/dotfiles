#!/usr/bin/env bash

xmobar_actions() {
  local script="$1"
  shift

  # Get the rendered text once
  local text
  text="$("$script")" || return 0

  # Wrap text in nested <action> tags in REVERSE order
  local i
  for ((i=$#; i>0; i--)); do
    local action="${!i}"
    local button="${action%%:*}"
    local args="${action#*:}"
    text="<action=\`$script $args\` button=$button>$text</action>"
  done

  # Print final nested text
  printf '%s' "$text"
}
