#!/usr/bin/env bash
source "${HOME}/.config/xmobar/scripts/vars"

xmobar_actions() {
  local script="$1"
  shift

  # Get the rendered text once
  local text
  text="$("$script")" || return 0

  # If text is empty (or only whitespace), output nothing
  [[ -z ${text//[[:space:]]/} ]] && return 0

  # Wrap text in nested <action> tags in REVERSE order
  local i
  for ((i=$#; i>0; i--)); do
    local action="${!i}"
    local button="${action%%:*}"
    local args="${action#*:}"
    text="<action=\`$script $args\` button=$button>$text</action>"
  done

  echo "${text}${SEP}"
}
