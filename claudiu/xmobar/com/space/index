#!/usr/bin/env bash

# Vars/state already exported from scripts/bar
source "${HOME}/.config/xmobar/scripts/state_loader"
source "${HOME}/.config/xmobar/scripts/page/index" 1

COM="${HOME}/.config/xmobar/com/space"
STATE_FILE="${HOME}/.config/xmobar/scripts/state"

# Initialize state if needed
state_init "space_toggle" 0


# If action is called, re-source state to get current values
if [[ -n "$1" ]]; then
  source "${STATE_FILE}"
fi

case "$1" in
  toggle) ${COM}/actions/toggle \
    --value=${space_toggle}     \
    --STATE_FILE=${STATE_FILE}  \
    --KEY=space_toggle
    # Re-source state after action to get updated value
    source "${STATE_FILE}" ;;
  *) ;;
esac

formats=("avail" "used")
colors=(${COLOR_WHITE} ${COLOR_WARNING})

root="$(df -h --output=${formats[$space_toggle]} /     | tail -1)"
home="$(df -h --output=${formats[$space_toggle]} /home | tail -1)"

echo "<fc=${colors[$space_toggle]}>ï‘³ ${root} /${home}</fc>"
